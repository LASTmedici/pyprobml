An error occurred while executing the following cell:
------------------
import jax
import jax.numpy as jnp

try:
    from flax import linen as nn
except ModuleNotFoundError:
    %pip install -qq flax
    from flax import linen as nn
try:
    from torchvision import datasets
except ModuleNotFoundError:
    %pip install -qq torchvision
    from torchvision import datasets


def get_datasets(n_tr, n_te):
    train_test = {}
    for split in {"train", "test"}:
        data = datasets.MNIST("./data", train=split == "train", download=True)
        n = n_tr if split == "train" else n_te
        key = jax.random.PRNGKey(42)
        rp = jax.random.permutation(key, len(data))[:n]
        X = jnp.full((n, 16, 16, 1), 0.0, dtype=jnp.float32)
        Y = jnp.full((n, 10), -1.0, dtype=jnp.float32)
        for i, ix in enumerate(rp):
            I, yint = data[int(ix)]
            xi = jnp.array(I, dtype=jnp.float32) / 127.5 - 1.0
            xi = jax.image.resize(xi, (16, 16), "bilinear")
            X = X.at[i].set(jnp.expand_dims(xi, axis=2))
            Y = Y.at[i, yint].set(1.0)
        train_test[split] = (X, Y)
    return train_test
------------------

---------------------------------------------------------------------------
ModuleNotFoundError                       Traceback (most recent call last)
/tmp/ipykernel_4109/3339551067.py in <module>
      4 try:
----> 5     from flax import linen as nn
      6 except ModuleNotFoundError:

~/miniconda3/envs/py37/lib/python3.7/site-packages/flax/__init__.py in <module>
     18 from . import core as core
---> 19 from . import linen as linen
     20 from . import optim as optim

~/miniconda3/envs/py37/lib/python3.7/site-packages/flax/linen/__init__.py in <module>
     19 # re-export commonly used modules and functions
---> 20 from .activation import (
     21   PReLU as PReLU,

~/miniconda3/envs/py37/lib/python3.7/site-packages/flax/linen/activation.py in <module>
     21 
---> 22 from flax.linen.module import compact
     23 from flax.linen.module import Module

~/miniconda3/envs/py37/lib/python3.7/site-packages/flax/linen/module.py in <module>
     38     union_filters)
---> 39 from flax.linen import summary
     40 

~/miniconda3/envs/py37/lib/python3.7/site-packages/flax/linen/summary.py in <module>
     25 import rich.text
---> 26 import yaml
     27 

ModuleNotFoundError: No module named 'yaml'

During handling of the above exception, another exception occurred:

ModuleNotFoundError                       Traceback (most recent call last)
/tmp/ipykernel_4109/3339551067.py in <module>
      6 except ModuleNotFoundError:
      7     get_ipython().run_line_magic('pip', 'install -qq flax')
----> 8     from flax import linen as nn
      9 try:
     10     from torchvision import datasets

~/miniconda3/envs/py37/lib/python3.7/site-packages/flax/__init__.py in <module>
     17 
     18 from . import core as core
---> 19 from . import linen as linen
     20 from . import optim as optim
     21 # DO NOT REMOVE - Marker for internal deprecated API.

~/miniconda3/envs/py37/lib/python3.7/site-packages/flax/linen/__init__.py in <module>
     18 # pylint: disable=g-multiple-import
     19 # re-export commonly used modules and functions
---> 20 from .activation import (
     21   PReLU as PReLU,
     22   celu as celu,

~/miniconda3/envs/py37/lib/python3.7/site-packages/flax/linen/activation.py in <module>
     20 from typing import Any, Optional
     21 
---> 22 from flax.linen.module import compact
     23 from flax.linen.module import Module
     24 

~/miniconda3/envs/py37/lib/python3.7/site-packages/flax/linen/module.py in <module>
     37     CollectionFilter, DenyList, FrozenVariableDict, Variable, VariableDict,
     38     union_filters)
---> 39 from flax.linen import summary
     40 
     41 

~/miniconda3/envs/py37/lib/python3.7/site-packages/flax/linen/summary.py in <module>
     24 import rich.table
     25 import rich.text
---> 26 import yaml
     27 
     28 PRNGKey = Any  # pylint: disable=invalid-name

ModuleNotFoundError: No module named 'yaml'
ModuleNotFoundError: No module named 'yaml'
